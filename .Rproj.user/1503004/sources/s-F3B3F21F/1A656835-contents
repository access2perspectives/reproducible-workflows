# Project information ----
# RespPCT trial
# Contact Researcher: Frank O'Riordan
# Contact email: fmoriordan@hotmail.com
# August 2018
# tables

# Table 1

# A basic, descriptive table that you would usually see as Table 1 in a
# publication

# Select the data
source("scripts/script_1_initial_data_prep.R")
source("scripts/functions.R")

# Table 1 ----
# General overview
# Grab the columns needed for Table 1
table.1.data <- pt_info %>%
  select("study.group",
          "gender",                                                       
          "age",                                                          
          "los.days",                                                     
          "smoking.status")                                               
         
variable <- name.1(table.1.data)

total <- summary.1(table.1.data)

table1_pct <- table.1.data %>%
  filter(study.group == "pct") 

table1_ctrl <- table.1.data %>%
  filter(study.group == "control")

table1_resp_ctrl <- table.1.data %>%
  filter(study.group == "resp.control")

arm_pct <- summary.1(table1_pct)

arm_ctrl <- summary.1(table1_ctrl)

arm_resp_ctrl <- summary.1(table1_resp_ctrl)

# min_max_t <- min.max(table1.tbl)

# min_max_a <- min.max(table1_arm_a)

# min_max_b <- min.max(table1_arm_b)


# table1 <- cbind(variable, total, arm_pct, arm_ctrl, arm_resp_ctrl) 

# colnames(table1) <- c("Variable", "Standard diet (n = 39)", "min - max S",
                     # "Modified diet (n = 35)", "min - max")

# Give factor levels better names if neeed

table1 <- cbind(variable, total, arm_pct, arm_ctrl, arm_resp_ctrl) 

table1  %>%
  
  ########----------------
# Export html table for Word
stargazer(type = "html",
          summary = FALSE,
          out = "table121.htm",
          digits = 1, rownames = FALSE)



# Table 2 ----
# Variables
table.2.data <- patient_info %>%
  mutate(infection.source = factor(infection.source),
         adverse.events = factor(adverse.events, levels = c("TRUE", "FALSE")),
         comorbidities.1 = factor(ifelse(is.na(comorbidities.1), FALSE, TRUE), levels = c("TRUE", "FALSE")),
         comorbidities.2 = factor(ifelse(is.na(comorbidities.2), FALSE, TRUE), levels = c("TRUE", "FALSE")),
         comorbidities.3 = factor(ifelse(is.na(comorbidities.3), FALSE, TRUE), levels = c("TRUE", "FALSE")),
         comorbidities.4 = factor(ifelse(is.na(comorbidities.4), FALSE, TRUE), levels = c("TRUE", "FALSE")),
         cough = factor(cough, levels = c("TRUE", "FALSE")),
         sob = factor(sob, levels = c("TRUE", "FALSE")),
         productive.of.sputum = factor(productive.of.sputum, levels = c("TRUE", "FALSE")),
         dyspnoea = factor(dyspnoea, levels = c("TRUE", "FALSE")),
         tachypnea = factor(tachypnea, levels = c("TRUE", "FALSE")),
         pleuritic.pain = factor(pleuritic.pain, levels = c("TRUE", "FALSE")),
         rigors = factor(rigors, levels = c("TRUE", "FALSE")),
         fever = factor(fever, levels = c("TRUE", "FALSE")),
         chills = factor(chills, levels = c("TRUE", "FALSE")),
         respiratory.failure = factor(respiratory.failure, levels = c("TRUE", "FALSE")),
         antibiotic.preadmission = factor(antibiotic.preadmission, levels = c("TRUE", "FALSE")),
         corticosteroid.preadmission = factor(corticosteroid.preadmission, levels = c("TRUE", "FALSE")),
         confusion = factor(confusion, levels = c("TRUE", "FALSE")),
         abnormal.chest.exam = factor(abnormal.chest.exam, levels = c("TRUE", "FALSE")),
         abnormal.radiological.findings = factor(abnormal.radiological.findings, levels = c("TRUE", "FALSE")),
         hosptal.readmission.within.30.days = factor(hosptal.readmission.within.30.days, levels = c("TRUE", "FALSE")),
         relapse.of.infection.within.30.days = factor(relapse.of.infection.within.30.days, levels = c("TRUE", "FALSE"))) %>%
      select("study.group",
         "resp.rate",                                                    
         "systolic.bp",                                                  
         "diastolic.bp",                                                 
         "heartrate",                                                    
         "temperature", 
         "cough",                                                        
         "sob",       
         "comorbidities.1",                                              
         "comorbidities.2",                                             
         "comorbidities.3",                                              
         "comorbidities.4",
         "productive.of.sputum",                                         
         "dyspnoea",                                                     
         "tachypnea",                                                    
         "pleuritic.pain",                                               
         "rigors",                                                       
         "fever",                                                        
         "chills",                                                       
         "respiratory.failure",                                          
         "antibiotic.preadmission",                                      
         "corticosteroid.preadmission",                                  
         "confusion",
         "abnormal.chest.exam",                                          
         "findings.during.ausculations",                                 
         "abnormal.radiological.findings",                               
         "number.of.clinical.signs.of.infection",                        
         "number.of.signs.of.acute.respiratory.illness",                 
         "infection.source",                                             
         "hosptal.readmission.within.30.days",                           
         "relapse.of.infection.within.30.days",                          
         "adverse.events")

variable <- name.1(table.2.data)

total <- summary.1(table.2.data)

table2_pct <- table.2.data %>%
  filter(study.group == "PCT") 

table2_ctrl <- table.2.data %>%
  filter(study.group == "Control")

table2_resp_ctrl <- table.2.data %>%
  filter(study.group == "Resp control")

arm_pct <- summary.1(table2_pct)

arm_ctrl <- summary.1(table2_ctrl)

arm_resp_ctrl <- summary.1(table2_resp_ctrl)

# min_max_t <- min.max(table1.tbl)

min_max_a <- min.max(table1_arm_a)

min_max_b <- min.max(table1_arm_b)


table2 <- cbind(variable, total, arm_pct, arm_ctrl, arm_resp_ctrl) 

# Give factor levels better names if neeed

# Put it all together
  data_frame(Variable = name.1(x),
             col2 = summary.1(x),
             "(Min, Max)" = min.max(x)) 
table2  %>%

########----------------
# Export html table for Word
  stargazer(type = "html",
            summary = FALSE,
            out = "table2.htm",
            digits = 1, rownames = FALSE)

# Table 3 ----
# Summary statisitcs of main data columns
abx_distinct <- abx %>%
  distinct(patient.id, .keep_all = TRUE)

table.3.data <- abx_distinct %>%
  select(-patient.id)

variable <- name.1(table.3.data)

total <- summary.1(table.3.data)

table3_pct <- table.3.data %>%
  filter(study.group == "pct") 

table3_ctrl <- table.3.data %>%
  filter(study.group == "control")

table3_resp_ctrl <- table.3.data %>%
  filter(study.group == "resp.control")

arm_pct <- summary.1(table3_pct)

arm_ctrl <- summary.1(table3_ctrl)

arm_resp_ctrl <- summary.1(table3_resp_ctrl)

min_max_p <- min.max(table3_pct)

min_max_r <- min.max(table3_resp_ctrl)

min_max_c <- min.max(table3_ctrl)

table3 <- cbind(variable, total, arm_pct, min_max_p, arm_resp_ctrl,  min_max_r, arm_ctrl, min_max_c) 

# Give factor levels better names if neeed

# Put it all together
# data_frame(Variable = name.1(x),
  #         col2 = summary.1(x),
  #         "(Min, Max)" = min.max(x)) 
table3  %>%
  
  ########----------------
# Export html table for Word
stargazer(type = "html",
          summary = FALSE,
          out = "tables/table3.htm",
          digits = 1, rownames = FALSE)

  